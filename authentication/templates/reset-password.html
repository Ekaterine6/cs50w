<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link rel="stylesheet" href="/static/styles.css">
  <title>Verification</title>
  <style>
                body {
              font-family: Arial, sans-serif;
              display: flex;
              justify-content: center;
              align-items: center;
              min-height: 100vh;
              margin: 0;
              background: linear-gradient(135deg, #1d3557, #457b9d);
              overflow: hidden;
            }
            .message-container {
              position: relative; /* Enables positioning inside the container */
              text-align: center;
              background: #457b9d;
              border-radius: 25px;
              padding: 25px;
              width: 350px;
              box-shadow: 0 0 20px rgba(241, 250, 238, 0.6); /* Soft glow effect */
              animation: bounce 1s infinite alternate ease-in-out;
            }
            label {
              display: block;
              margin: 8px 0 4px;
            }
            input {
              width: 100%;
              padding: 8px;
              margin-bottom: 10px;
              box-sizing: border-box;
            }
            button {
              padding: 10px 15px;
              font-size: 16px;
              cursor: pointer;
            }
            .hidden {
              display: none;
            }

            .login_pass, .login_email {
              width: 100%;
              height: 40px;
              border: none;
              border-radius: 15px;
              outline: none;
              padding: 10px;
              margin-bottom: 15px;
              font-size: 16px;
              color: #f1faee;
              background: #457b9d;
              box-shadow: 0 0 15px rgba(241, 250, 238, 0.6); /* Input glow */
              transition: box-shadow 0.3s ease;
            }
            
            .submit-btn {
              margin-top: 15px;
              padding: 10px 20px;
              font-size: 16px;
              color: #457b9d;
              background: #f1faee;
              border: none;
              border-radius: 20px;
              cursor: pointer;
              transition: background 0.3s ease, transform 0.2s ease;
            }

            .submit-btn:hover {
              background: #a8dadc;
              transform: scale(1.05);
            }
  </style>
</head>
<body>
  <div class="message-container">
    <div class="icon">🔑</div>
  <h2>პაროლის განახლება SMS ვერიფიკაციით</h2>
  <div id="menu-container"></div> <!-- Placeholder for the menu -->
  <script src="/static/menu.js"></script>

  <!-- Form to request the verification code -->
  <form id="startVerificationForm">
    <h3>ვერიფიკაციის კოდის მოთხოვნა</h3>
    <label for="email">Email:</label>
    <input 
      type="email" 
      id="email" 
      name="email" 
      placeholder="შეიყვანეთ Email" 
      required 
    />

    <label for="phone">ტელეფონი (+995XXXXXXXX):</label>
    <input 
      type="text" 
      id="phone" 
      name="phone"
      placeholder="+995XXXXXXXX" 
      required 
    />

    <button type="submit">ვერიფიკაციის კოდის მიღება</button>
  </form>

  <!-- Form to verify the code and reset the password -->
  <form id="checkVerificationForm" class="hidden">
    <h3>დაადასტურე კოდი და გაანახლე პაროლი</h3>
    <label for="code">ვერიფიკაციის კოდი:</label>
    <input 
      type="text" 
      id="code" 
      name="code" 
      placeholder="000000" 
      required 
    />

    <label for="newPassword">ახალი პაროლი:</label>
    <input 
      type="password" 
      id="newPassword" 
      name="newPassword" 
      placeholder="Abcd123!" 
      required 
    />

    <button class="submit-btn" type="submit">პაროლის განახლება</button>
  </form>
  </div>
  <script>
    // Handle the start verification form submission
    document.getElementById("startVerificationForm").addEventListener("submit", function(e) {
      e.preventDefault();
      const formData = new FormData(this);
      const data = new URLSearchParams(formData);
      
      fetch("/start-verification", {
        method: "POST",
        headers: {
          "Content-Type": "application/x-www-form-urlencoded"
        },
        body: data
      })
      .then(response => {
        if (!response.ok) return response.text().then(text => { throw new Error(text) });
        return response.json();
      })
      .then(result => {
        alert(result.message);
        console.log("Verification status returned:", result.status);
        // Regardless of the status value, show the verification/reset form.
        document.getElementById("startVerificationForm").classList.add("hidden");
        document.getElementById("checkVerificationForm").classList.remove("hidden");
      })
      .catch(error => {
        console.error("Error starting verification:", error);
        alert("Error: " + error.message);
      });
    });

    // Handle the check verification form submission
    document.getElementById("checkVerificationForm").addEventListener("submit", function(e) {
      e.preventDefault();
      const formData = new FormData(this);
      const data = new URLSearchParams(formData);
      
      fetch("/check-verification", {
        method: "POST",
        headers: {
          "Content-Type": "application/x-www-form-urlencoded"
        },
        body: data
      })
      .then(response => {
        if (!response.ok) return response.text().then(text => { throw new Error(text) });
        return response.text();
      })
      .then(result => {
        alert(result);
        // Optionally, you can redirect or refresh after a successful password reset.
      })
      .catch(error => {
        console.error("Error verifying code:", error);
        alert("Error: " + error.message);
      });
    });
  </script>
</body>
</html>
